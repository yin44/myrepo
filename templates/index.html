{% extends "base.html" %}

{% block content %}
<h2 class="mb-4">Featured Laptops</h2>
<div class="row">
    {% for laptop in laptops %}
    <div class="col-md-4 mb-4">
        <div class="card h-100">
            {% if laptop['image'] %}
            <img src="{{ url_for('static', filename='images/' ~ laptop['image']) }}" class="card-img-top" alt="{{ laptop['brand'] }} {{ laptop['model'] }}">
            {% else %}
            <img src="{{ url_for('static', filename='images/default.jpg') }}" class="card-img-top" alt="No image">
            {% endif %}
            <div class="card-body">
                <h5 class="card-title">{{ laptop['brand'] }} {{ laptop['model'] }}</h5>
                <p class="card-text">{{ laptop['specs'] }}</p>
                <p class="card-text">
                    {% if laptop['discount'] and laptop['discount'] > 0 %}
                        <span class="text-muted"><del>${{ laptop['price'] }}</del></span>
                        <span class="text-danger font-weight-bold">${{ (laptop['price'] * (1 - laptop['discount']/100))|round(2) }}</span>
                    {% else %}
                        <span class="font-weight-bold">${{ laptop['price'] }}</span>
                    {% endif %}
                </p>
                {% if laptop['promotion'] %}
                <span class="badge badge-success">{{ laptop['promotion'] }}</span>
                {% endif %}
                <a href="{{ url_for('product', laptop_id=laptop['id']) }}" class="btn btn-primary mt-2">View Details</a>
                {% if current_user.is_authenticated and current_user.role == 'admin' %}
                    <a href="{{ url_for('edit_product', laptop_id=laptop.id) }}" class="btn btn-warning btn-sm">Update</a>
                    <a href="{{ url_for('delete_product', laptop_id=laptop.id) }}" class="btn btn-danger btn-sm">Delete</a>
                
                {% elif current_user.is_authenticated and current_user.role != 'admin' %}
                    <form method="post" action="{{ url_for('add_to_cart', laptop_id=laptop.id) }}">
                        <button type="submit" class="btn btn-primary">Add to Cart</button>
                    </form>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Pagination Controls -->
<nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">
        {% set total_pages = (total // per_page) + (1 if total % per_page > 0 else 0) %}
        <li class="page-item {% if page <= 1 %}disabled{% endif %}">
            <a class="page-link" href="{{ url_for('index', page=page-1) }}">Previous</a>
        </li>
        {% for p in range(1, total_pages + 1) %}
        <li class="page-item {% if p == page %}active{% endif %}">
            <a class="page-link" href="{{ url_for('index', page=p) }}">{{ p }}</a>
        </li>
        {% endfor %}
        <li class="page-item {% if page >= total_pages %}disabled{% endif %}">
            <a class="page-link" href="{{ url_for('index', page=page+1) }}">Next</a>
        </li>
    </ul>
</nav>
{% endblock %}